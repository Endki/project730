<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">	

<mapper namespace="com.bangba.project730.model.dao.ArticleDao">

	<insert id="createArticle" parameterType="ArticleDto">
		insert into article (user_no, title_kor, title_eng, like_cnt, bookmark_cnt, hits, created_at, updated_at, like_weekly, content, img_path, category, abv, cup_no)
		values (#{user_no}, #{title_kor}, #{title_eng}, #{like_cnt}, #{bookmark_cnt}, #{hits}, #{created_at}, #{updated_at}
		, #{like_weekly}, #{content}, #{img_path}, #{category}, #{abv}, #{cup_no})		
	</insert>
	
	<select id="searchArticle" resultType="ArticleDto" parameterType="TaglistDto">
		select * from article
		where pk_article in (select distinct article_no from article_tag 
		where tag_no in (select pk_tag from tag 
		<if test="tag1 != null">
    	where content_kor like #{tag1} or content_eng like #{tag1}
  		</if>
  		<if test="tag2 != null">
    	or content_kor like #{tag2} or content_eng like #{tag2}
  		</if>
  		<if test="tag3 != null">
    	or content_kor like #{tag3} or content_eng like #{tag3}
  		</if>
  		<if test="tag4 != null">
    	or content_kor like #{tag4} or content_eng like #{tag4}
  		</if>
  		<if test="tag5 != null">
    	or content_kor like #{tag5} or content_eng like #{tag5}
  		</if>
  		<if test="tag6 != null">
    	or content_kor like #{tag6} or content_eng like #{tag6}
  		</if>
  		<if test="tag7 != null">
    	or content_kor like #{tag7} or content_eng like #{tag7}
  		</if>
  		<if test="tag8 != null">
    	or content_kor like #{tag8} or content_eng like #{tag8}
  		</if>
  		<if test="tag9 != null">
    	or content_kor like #{tag9} or content_eng like #{tag9}
  		</if>
  		<if test="tag10 != null">
    	or content_kor like #{tag10} or content_eng like #{tag10}
  		</if>
  		)) 
		and (title_kor like concat('%', #{searchtxt}, '%') or title_eng like concat('%', #{searchtxt}, '%')) 
	</select>
	
	<select id="searchArticlePK" resultType="int" parameterType="ArticleDto">
		select max(pk_article) from article
		where user_no = #{user_no} and title_kor = #{title_kor} and created_at = #{created_at}
	</select>
	
	<update id="updateArticle" parameterType="ArticleDto">
		update article set 
		title_kor = #{title_kor}, title_eng = #{title_eng}, updated_at = #{updated_at}, content = #{content}, img_path = #{img_path}, 
		where pk_article = #{pk_article}
	</update>
	
	<select id="searchUpdateArticlePK" resultType="int" parameterType="ArticleDto">
		select max(pk_article) from article
		where user_no = #{user_no} and title_kor = #{title_kor} and updated_at = #{updated_at}
	</select>
	
	<delete id="deleteArticle" parameterType="int">
		delete from article
		where pk_article = #{pk_article}
	</delete>
	
	
	<select id="detailArticle" resultType="ArticleDto" parameterType="int">
		select * from article
		where pk_article = #{pk_article}
	</select>
	
	
	<insert id="addArticleAlcohol" parameterType="Article_alcoholDto">
		insert into article_alcohol (article_no, alcohol_no, quantity, unit)
		values (#{article_no}, #{alcohol_no}, #{quantity}, #{unit})	
	</insert>
	
	<select id="searchArticleAlcohol" resultType="Article_alcoholDto" parameterType="int">
		select * from article_alcohol
		where article_no = #{pk_article}
	</select>
	
	<delete id="deleteArticleAlcohol" parameterType="int">
		delete from article_alcohol
		where article_no = #{article_no}
	</delete>
	
	
	<insert id="addArticleIngredient" parameterType="Article_ingredientDto">
		insert into article_ingredient (article_no, ingredient_no, type, quantity, unit)
		values (#{article_no}, #{ingredient_no}, #{type}, #{quantity}, #{unit})	
	</insert>
	
	<select id="searchArticleIngredient" resultType="Article_ingredientDto" parameterType="int">
		select * from article_ingredient
		where article_no = #{pk_article}
	</select>
	
	<delete id="deleteArticleIngredient" parameterType="int">
		delete from article_ingredient
		where article_no = #{article_no} 
	</delete>
	
	
	<insert id="addArticleTag" parameterType="int">
		insert into article_tag (article_no, tag_no)
		values (#{pk_article}, #{pk_tag})	
	</insert>
	
	<select id="searchArticleTag" resultType="Article_tagDto" parameterType="int">
		select * from article_tag
		where article_no = #{pk_article}
	</select>
	
	<delete id="deleteArticleTag" parameterType="int">
		delete from article_tag
		where article_no = #{article_no} 
	</delete>
	
	
	<insert id="addRecipe" parameterType="RecipeDto">
		insert into recipe (article_no, content, num)
		values (#{article_no}, #{content}, #{num})	
	</insert>
	
	<select id="searchRecipe" resultType="RecipeDto" parameterType="int">
		select * from recipe
		where article_no = #{pk_article} order by num
	</select>
	
	<delete id="deleteRecipe" parameterType="int">
		delete from recipe
		where article_no = #{pk_article}
	</delete>
	
</mapper>